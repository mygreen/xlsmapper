<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ja"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>XlsMapper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">XlsMapper</a> &gt; <a href="index.source.html" class="el_package">com.gh.mygreen.xlsmapper</a> &gt; <span class="el_source">XlsMapper.java</span></div><h1>XlsMapper.java</h1><pre class="source lang-java linenums">package com.gh.mygreen.xlsmapper;

import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;

import com.gh.mygreen.xlsmapper.annotation.XlsColumn;
import com.gh.mygreen.xlsmapper.annotation.XlsDateTimeConverter;
import com.gh.mygreen.xlsmapper.annotation.XlsHorizontalRecords;
import com.gh.mygreen.xlsmapper.annotation.XlsLabelledCell;
import com.gh.mygreen.xlsmapper.annotation.XlsRecordOption;
import com.gh.mygreen.xlsmapper.annotation.XlsRecordOption.OverOperation;
import com.gh.mygreen.xlsmapper.annotation.XlsSheet;
import com.gh.mygreen.xlsmapper.validation.MultipleSheetBindingErrors;
import com.gh.mygreen.xlsmapper.validation.SheetBindingErrors;


/**
 * ExcelのシートとJavaオブジェクトをマッピングする機能を提供する。
 *
 * &lt;h3 class=&quot;description&quot;&gt;マッピングの基本&lt;/h3&gt;
 * &lt;p&gt;次のような表のExcelシートをマッピングする例を説明します。&lt;/p&gt;
 *
 * &lt;div class=&quot;picture&quot;&gt;
 *    &lt;img src=&quot;doc-files/howto_load.png&quot; alt=&quot;&quot;&gt;
 *    &lt;p&gt;基本的なマッピング&lt;/p&gt;
 * &lt;/div&gt;
 *
 * &lt;p&gt;まず、シート1つに対して、POJOクラスを作成します。&lt;/p&gt;
 * &lt;ul&gt;
 *   &lt;li&gt;シート名を指定するために、アノテーション {@link XlsSheet} をクラスに付与します。&lt;/li&gt;
 *   &lt;li&gt;見出し付きのセル「Date」をマッピングするフィールドに、アノテーション {@link XlsLabelledCell} に付与します。&lt;/li&gt;
 *   &lt;li&gt;表「User List」をマッピングするListのフィールドに、アノテーション {@link XlsHorizontalRecords} を付与します。&lt;/li&gt;
 * &lt;/ul&gt;
 *
 *
 * &lt;pre class=&quot;highlight&quot;&gt;&lt;code class=&quot;java&quot;&gt;
 * // シート用のPOJOクラスの定義
 * {@literal @XlsSheet(name=&quot;List&quot;)}
 * public class UserSheet {
 *
 *     {@literal @XlsLabelledCell(label=&quot;Date&quot;, type=LabelledCellType.Right)}
 *     Date createDate;
 *
 *     {@literal @XlsHorizontalRecords(tableLabel=&quot;User List&quot;)}
 *     {@literal List&lt;UserRecord&gt;} users;
 *
 * }
 * &lt;/code&gt;&lt;/pre&gt;
 *
 *
 * &lt;p&gt;続いて、表「User List」の1レコードをマッピングするための、POJOクラスを作成します。&lt;/p&gt;
 * &lt;ul&gt;
 *   &lt;li&gt;レコードの列をマッピングするために、アノテーション {@link XlsColumn} をフィールドに付与します。&lt;/li&gt;
 *   &lt;li&gt;フィールドのクラスタイプが、intや列挙型の場合もマッピングできます。&lt;/li&gt;
 * &lt;/ul&gt;
 *
 * &lt;pre class=&quot;highlight&quot;&gt;&lt;code class=&quot;java&quot;&gt;
 * // レコード用のPOJOクラスの定義
 * public class UserRecord {
 *
 *     {@literal @XlsColumn(columnName=&quot;ID&quot;)}
 *     int no;
 *
 *     {@literal @XlsColumn(columnName=&quot;Class&quot;, merged=true)}
 *     String className;
 *
 *     {@literal @XlsColumn(columnName=&quot;Name&quot;)}
 *     String name;
 *
 *     {@literal @XlsColumn(columnName=&quot;Gender&quot;)}
 *     Gender gender;
 *
 * }
 *
 * // 性別を表す列挙型の定義
 * public enum Gender {
 *    male, female;
 * }
 * &lt;/code&gt;&lt;/pre&gt;
 *
 *
 * &lt;p&gt;作成したPOJOを使ってシートを読み込むときは、XlsMapper#load メソッドを利用します。&lt;/p&gt;
 *
 * &lt;pre class=&quot;highlight&quot;&gt;&lt;code class=&quot;java&quot;&gt;
 * // シートの読み込み
 * XlsMapper xlsMapper = new XlsMapper();
 * UserSheet sheet = xlsMapper.load(
 *         new FileInputStream(&quot;example.xls&quot;), // 読み込むExcelファイル。
 *         UserSheet.class                     // シートマッピング用のPOJOクラス。
 *   );
 * &lt;/code&gt;&lt;/pre&gt;
 *
 *
 * &lt;h3 class=&quot;description&quot;&gt;書き込み方の基本&lt;/h3&gt;
 * &lt;p&gt;同じシートの形式を使って、書き込み方を説明します。
 *   &lt;br&gt;まず、書き込み先のテンプレートとなるExcelシートを用意します。 レコードなどは空を設定します。
 * &lt;/p&gt;
 *
 * &lt;div class=&quot;picture&quot;&gt;
 *    &lt;img src=&quot;doc-files/howto_save.png&quot; alt=&quot;&quot;&gt;
 *    &lt;p&gt;データが空のテンプレートファイル&lt;/p&gt;
 * &lt;/div&gt;
 *
 * &lt;p&gt;続いて、読み込み時に作成したシート用のマッピングクラスに、書き込み時の設定を付け加えるために修正します。&lt;/p&gt;
 * &lt;ul&gt;
 *   &lt;li&gt;セル「Date」の書き込み時の書式を指定するために、アノテーション {@link XlsDateTimeConverter} に付与します。
 *     &lt;br&gt;属性 {@link XlsDateTimeConverter#excelPattern()} でExcelのセルの書式を設定します。
 *   &lt;/li&gt;
 *   &lt;li&gt;表「User List」のレコードを追加する操作を指定するために、アノテーションの属性 {@link XlsRecordOption#overOperation()}を指定します。
 *     &lt;br&gt;テンプレート上は、レコードが1行分しかないですが、実際に書き込むレコード数が2つ以上の場合、足りなくなるため、その際のシートの操作方法を指定します。
 *     &lt;br&gt;今回の{@link OverOperation#Insert}は、行の挿入を行います。
 *   &lt;/li&gt;
 * &lt;/ul&gt;
 *
 * &lt;pre class=&quot;highlight&quot;&gt;&lt;code class=&quot;java&quot;&gt;
 * // シート用のPOJOクラスの定義
 * {@literal @XlsSheet(name=&quot;List&quot;)}
 * public class UserSheet {
 *
 *     {@literal @XlsLabelledCell(label=&quot;Date&quot;, type=LabelledCellType.Right)}
 *     {@literal @XlsDateTimeConverter(excelPattern=&quot;yyyy/m/d&quot;)}
 *     Date createDate;
 *
 *     {@literal @XlsHorizontalRecords(tableLabel=&quot;User List&quot;)}
 *     {@literal @XlsRecordOperation(overCase=OverOperation#Insert)}
 *     {@literal List&lt;UserRecord&gt;} users;
 *
 * }
 * &lt;/code&gt;&lt;/pre&gt;
 *
 * &lt;p&gt;修正したPOJOを使ってシートを書き込むときは、 XlsMapper#save メソッドを利用します。&lt;/p&gt;
 *
 * &lt;pre class=&quot;highlight&quot;&gt;&lt;code class=&quot;java&quot;&gt;
 * // 書き込むシート情報の作成
 * UserSheet sheet = new UserSheet();
 * sheet.createDate = new Date();
 *
 * {@literal List&lt;UserRecord&gt;} users = new {@literal ArrayList&lt;&gt;}();
 *
 * // 1レコード分の作成
 * UserRecord record1 = new UserRecord();
 * record1.no = 1;
 * record1.className = &quot;A&quot;;
 * record1.name = &quot;Ichiro&quot;;
 * record1.gender = Gender.male;
 * users.add(record1);
 *
 * UserRecord record2 = new UserRecord();
 * // ... 省略
 * users.add(record2);
 *
 * sheet.users = users;
 *
 * // シートの書き込み
 * XlsMapper xlsMapper = new XlsMapper();
 * xlsMapper.save(
 *     new FileInputStream(&quot;template.xls&quot;), // テンプレートのExcelファイル
 *     new FileOutputStream(&quot;out.xls&quot;),     // 書き込むExcelファイル
 *     sheet                                // 作成したデータ
 *     );
 * &lt;/code&gt;&lt;/pre&gt;
 *
 * @version 2.0
 * @author T.TSUCHIE
 *
 */
public class XlsMapper {

    private Configuration configuration;

    private XlsLoader loader;

    private XlsSaver saver;

    /**
     * デフォルトコンストラクタ
     */
<span class="fc" id="L179">    public XlsMapper() {</span>
<span class="fc" id="L180">        this.configuration = new Configuration();</span>
<span class="fc" id="L181">        this.loader = new XlsLoader(getConfiguration());</span>
<span class="fc" id="L182">        this.saver = new XlsSaver(getConfiguration());</span>
<span class="fc" id="L183">    }</span>

    /**
     * システム情報を取得します。
     * @return 現在のシステム情報
     */
    public Configuration getConfiguration() {
<span class="fc" id="L190">        return configuration;</span>
    }

    /**
     * システム情報を設定します。
     * @param configuration システム情報
     */
    public void setConfiguration(Configuration configuration) {
<span class="fc" id="L198">        this.configuration = configuration;</span>
<span class="fc" id="L199">        getLoader().setConfiguration(configuration);</span>
<span class="fc" id="L200">        getSaver().setConfiguration(configuration);</span>
<span class="fc" id="L201">    }</span>

    /**
     * 読み込み用クラスを取得します。
     * @return 読み込み用クラス
     */
    public XlsLoader getLoader() {
<span class="fc" id="L208">        return loader;</span>
    }

    /**
     * 保存用クラスを取得します。
     * @return 保存用クラス。
     */
    public XlsSaver getSaver() {
<span class="fc" id="L216">        return saver;</span>
    }

    /**
     * Excelファイルの１シートを読み込み、任意のクラスにマッピングする。
     *
     * @param &lt;P&gt; シートをマッピングするクラスタイプ
     * @param xlsIn 読み込みもとのExcelファイルのストリーム。
     * @param clazz マッピング先のクラスタイプ。
     * @return シートをマッピングしたオブジェクト。
     *         {@link Configuration#isIgnoreSheetNotFound()}の値がtrueで、シートが見つからない場合、nullを返します。
     * @throws IllegalArgumentException {@literal xlsIn == null or clazz == null}
     * @throws XlsMapperException Excelファイルのマッピングに失敗した場合
     * @throws IOException ファイルの読み込みに失敗した場合
     *
     */
    public &lt;P&gt; P load(final InputStream xlsIn, final Class&lt;P&gt; clazz) throws XlsMapperException, IOException {
<span class="fc" id="L233">        return loader.load(xlsIn, clazz);</span>
    }

    /**
     * Excelファイルの１シートを読み込み、任意のクラスにマッピングする。
     *
     * @param &lt;P&gt; シートをマッピングするクラスタイプ
     * @param xlsIn 読み込みもとのExcelファイルのストリーム。
     * @param clazz マッピング先のクラスタイプ。
     * @return シートのマッピング結果。
     *         {@link Configuration#isIgnoreSheetNotFound()}の値がtrueで、シートが見つからない場合、nullを返します。
     * @throws IllegalArgumentException {@literal xlsIn == null or clazz == null}
     * @throws XlsMapperException Excelファイルのマッピングに失敗した場合
     * @throws IOException ファイルの読み込みに失敗した場合
     */
    public &lt;P&gt; SheetBindingErrors&lt;P&gt; loadDetail(final InputStream xlsIn, final Class&lt;P&gt; clazz) throws XlsMapperException, IOException {
<span class="fc" id="L249">        return loader.loadDetail(xlsIn, clazz);</span>
    }

    /**
     * Excelファイルの複数シートを読み込み、任意のクラスにマップする。
     * &lt;p&gt;{@link XlsSheet#regex()}により、複数のシートが同じ形式で、同じクラスにマッピングすする際に使用します。&lt;/p&gt;
     *
     * @param xlsIn 読み込み元のExcelファイルのストリーム。
     * @param clazz マッピング先のクラスタイプ。
     * @return マッピングした複数のシート。
     *         {@link Configuration#isIgnoreSheetNotFound()}の値がtrueで、シートが見つからない場合、マッピング結果には含まれません。
     * @throws IllegalArgumentException {@literal xlsIn == null or clazz == null}
     * @throws XlsMapperException マッピングに失敗した場合
     * @throws IOException ファイルの読み込みに失敗した場合
     */
    public &lt;P&gt; P[] loadMultiple(final InputStream xlsIn, final Class&lt;P&gt; clazz) throws XlsMapperException, IOException {
<span class="fc" id="L265">        return loader.loadMultiple(xlsIn, clazz);</span>
    }

    /**
     * XMLによるマッピングを指定し、Excelファイルの複数シートを読み込み、任意のクラスにマップする。
     * &lt;p&gt;{@link XlsSheet#regex()}により、複数のシートが同じ形式で、同じクラスにマッピングすする際に使用します。&lt;/p&gt;
     *
     * @param &lt;P&gt; シートをマッピングするクラスタイプ
     * @param xlsIn 読み込み元のExcelファイルのストリーム。
     * @param clazz マッピング先のクラスタイプ。
     * @return 複数のシートのマッピング結果。
     *         {@link Configuration#isIgnoreSheetNotFound()}の値がtrueで、シートが見つからない場合、マッピング結果には含まれません。
     * @throws IllegalArgumentException {@literal xlsIn == null or clazz == null}
     * @throws XlsMapperException マッピングに失敗した場合
     * @throws IOException ファイルの読み込みに失敗した場合
     */
    public &lt;P&gt; MultipleSheetBindingErrors&lt;P&gt; loadMultipleDetail(final InputStream xlsIn, final Class&lt;P&gt; clazz)
            throws XlsMapperException, IOException {
<span class="fc" id="L283">        return loader.loadMultipleDetail(xlsIn, clazz);</span>
    }

    /**
     * Excelファイルの複数シートを読み込み、任意のクラスにマップする。
     * &lt;p&gt;複数のシートの形式を一度に読み込む際に使用します。&lt;/p&gt;
     *
     * @param xlsIn 読み込み元のExcelファイルのストリーム。
     * @param classes マッピング先のクラスタイプの配列。
     * @return マッピングした複数のシート。
     *         {@link Configuration#isIgnoreSheetNotFound()}の値がtrueで、シートが見つからない場合、マッピング結果には含まれません。
     * @throws IllegalArgumentException {@literal xlsIn == null or classes == null}
     * @throws IllegalArgumentException {@literal calsses.length == 0}
     * @throws XlsMapperException マッピングに失敗した場合
     * @throws IOException ファイルの読み込みに失敗した場合
     */
    public Object[] loadMultiple(final InputStream xlsIn, final Class&lt;?&gt;[] classes) throws XlsMapperException, IOException {
<span class="nc" id="L300">        return loader.loadMultiple(xlsIn, classes);</span>
    }

    /**
     * Excelファイルの複数シートを読み込み、任意のクラスにマップする。
     * &lt;p&gt;複数のシートの形式を一度に読み込む際に使用します。&lt;/p&gt;
     *
     * @param xlsIn 読み込み元のExcelファイルのストリーム。
     * @param classes マッピング先のクラスタイプの配列。
     * @return マッピングした複数のシートの結果。
     *         {@link Configuration#isIgnoreSheetNotFound()}の値がtrueで、シートが見つからない場合、マッピング結果には含まれません。
     * @throws IllegalArgumentException {@literal xlsIn == null or classes == null}
     * @throws IllegalArgumentException {@literal calsses.length == 0}
     * @throws IOException ファイルの読み込みに失敗した場合
     * @throws XlsMapperException マッピングに失敗した場合
     */
    public MultipleSheetBindingErrors&lt;Object&gt; loadMultipleDetail(final InputStream xlsIn, final Class&lt;?&gt;[] classes)
            throws XlsMapperException, IOException {
<span class="fc" id="L318">        return loader.loadMultipleDetail(xlsIn, classes);</span>
    }

    /**
     * JavaのオブジェクトをExeclファイルに出力する。
     * &lt;p&gt;出力するファイルは、引数で指定した雛形となるテンプレート用のExcelファイルをもとに出力する。&lt;/p&gt;
     *
     * @param templateXlsIn 雛形となるExcelファイルの入力
     * @param xlsOut 出力先のストリーム
     * @param beanObj 書き込むBeanオブジェクト
     * @throws IllegalArgumentException {@literal templateXlsIn == null or xlsOut == null or beanObj == null}
     * @throws XlsMapperException マッピングに失敗した場合
     * @throws IOException テンプレｰトのファイルの読み込みやファイルの出力に失敗した場合
     */
    public void save(final InputStream templateXlsIn, final OutputStream xlsOut, final Object beanObj) throws XlsMapperException, IOException {
<span class="fc" id="L333">        saver.save(templateXlsIn, xlsOut, beanObj);</span>
<span class="fc" id="L334">    }</span>

    /**
     * JavaのオブジェクトをExeclファイルに出力する。
     * &lt;p&gt;出力するファイルは、引数で指定した雛形となるテンプレート用のExcelファイルをもとに出力する。&lt;/p&gt;
     *
     * @param &lt;P&gt; マッピング対象のクラスタイプ
     * @param templateXlsIn 雛形となるExcelファイルの入力
     * @param xlsOut 出力先のストリーム
     * @param beanObjs 書き込むBeanオブジェクト
     * @return マッピング結果。
     *         {@link Configuration#isIgnoreSheetNotFound()}の値がtrueで、シートが見つからない場合、nullを返します。
     * @throws IllegalArgumentException {@literal templateXlsIn == null or xlsOut == null or beanObj == null}
     * @throws XlsMapperException マッピングに失敗した場合
     * @throws IOException テンプレｰトのファイルの読み込みやファイルの出力に失敗した場合
     */
    public &lt;P&gt; SheetBindingErrors&lt;P&gt; saveDetail(final InputStream templateXlsIn, final OutputStream xlsOut, final P beanObjs) throws XlsMapperException, IOException {
<span class="nc" id="L351">        return saver.saveDetail(templateXlsIn, xlsOut, beanObjs);</span>
    }

    /**
     * 複数のオブジェクトをそれぞれのシートへ保存する。
     * @param templateXlsIn 雛形となるExcelファイルの入力
     * @param xlsOut xlsOut 出力先のストリーム
     * @param beanObj 書き込むオブジェクトの配列。
     * @throws IllegalArgumentException {@literal templateXlsIn == null or xlsOut == null or beanObjs == null}
     * @throws IllegalArgumentException {@literal }
     * @throws XlsMapperException マッピングに失敗した場合
     * @throws IOException テンプレｰトのファイルの読み込みやファイルの出力に失敗した場合
     */
    public void saveMultiple(final InputStream templateXlsIn, final OutputStream xlsOut, final Object[] beanObj) throws XlsMapperException, IOException {
<span class="fc" id="L365">        saver.saveMultiple(templateXlsIn, xlsOut, beanObj);</span>
<span class="fc" id="L366">    }</span>

    /**
     * 複数のオブジェクトをそれぞれのシートへ保存する。
     * @param templateXlsIn 雛形となるExcelファイルの入力
     * @param xlsOut xlsOut 出力先のストリーム
     * @param beanObjs 書き込むオブジェクトの配列。
     * @return マッピング結果。
     *         {@link Configuration#isIgnoreSheetNotFound()}の値がtrueで、シートが見つからない場合、結果に含まれません。
     * @throws IllegalArgumentException {@literal templateXlsIn == null or xlsOut == null or beanObjs == null}
     * @throws IllegalArgumentException {@literal }
     * @throws XlsMapperException マッピングに失敗した場合
     * @throws IOException テンプレｰトのファイルの読み込みやファイルの出力に失敗した場合
     */
    public MultipleSheetBindingErrors&lt;Object&gt; saveMultipleDetail(final InputStream templateXlsIn, final OutputStream xlsOut, final Object[] beanObjs) throws XlsMapperException, IOException {
<span class="nc" id="L381">        return saver.saveMultipleDetail(templateXlsIn, xlsOut, beanObjs);</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>